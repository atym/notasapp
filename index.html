<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Notas de EspaÃ±ol</title>
    <link rel="apple-touch-icon" href="https://i.imgur.com/wsO1XNS.png">
    <link rel="icon" type="image/png" href="https://i.imgur.com/wsO1XNS.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { -webkit-tap-highlight-color: transparent; background-color: #111827; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { -webkit-backface-visibility: hidden; backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .flip-card-inner { transition: transform 0.5s; transform-style: preserve-3d; }
        .flipped .flip-card-inner { transform: rotateY(180deg); }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-white selection:bg-pink-500 selection:text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useLayoutEffect } = React;

        // --- ICONS ---
        const IconWrapper = ({ children, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>
        );
        
        const Icons = {
            User: (p)=><IconWrapper {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconWrapper>,
            Globe: (p)=><IconWrapper {...p}><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/></IconWrapper>,
            MessageCircle: (p)=><IconWrapper {...p}><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/></IconWrapper>,
            Calendar: (p)=><IconWrapper {...p}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></IconWrapper>,
            MapPin: (p)=><IconWrapper {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconWrapper>,
            Check: (p)=><IconWrapper {...p}><path d="M20 6 9 17l-5-5"/></IconWrapper>,
            ChevronRight: (p)=><IconWrapper {...p}><path d="m9 18 6-6-6-6"/></IconWrapper>,
            ArrowLeft: (p)=><IconWrapper {...p}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></IconWrapper>,
            Sun: (p)=><IconWrapper {...p}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></IconWrapper>,
            Cloud: (p)=><IconWrapper {...p}><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.3c-1.3-3.2-4.9-3.2-6.2 0H5.5c-2 0-3.5 1.5-3.5 3.5S3.5 23 5.5 23h12c1.7 0 3-1.3 3-3z"/></IconWrapper>,
            CloudRain: (p)=><IconWrapper {...p}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M16 14v6"/><path d="M8 14v6"/><path d="M12 16v6"/></IconWrapper>,
            Snowflake: (p)=><IconWrapper {...p}><line x1="2" x2="22" y1="12" y2="12"/><line x1="12" x2="12" y1="2" y2="22"/><path d="m20 20-4-4"/><path d="m4 4 4 4"/><path d="m4 20 4-4"/><path d="m20 4-4 4"/></IconWrapper>,
            Zap: (p)=><IconWrapper {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconWrapper>,
            Wind: (p)=><IconWrapper {...p}><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/></IconWrapper>,
            Thermometer: (p)=><IconWrapper {...p}><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/></IconWrapper>,
            Smile: (p)=><IconWrapper {...p}><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/></IconWrapper>,
            Frown: (p)=><IconWrapper {...p}><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/></IconWrapper>,
            Coffee: (p)=><IconWrapper {...p}><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/></IconWrapper>,
            Briefcase: (p)=><IconWrapper {...p}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></IconWrapper>,
            ChevronDown: (p)=><IconWrapper {...p}><path d="m6 9 6 6 6-6"/></IconWrapper>,
            Menu: (p)=><IconWrapper {...p}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></IconWrapper>,
            X: (p)=><IconWrapper {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconWrapper>,
            BookOpen: (p)=><IconWrapper {...p}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></IconWrapper>,
            BrainCircuit: (p)=><IconWrapper {...p}><path d="M12 5a3 3 0 1 0-5.997.6L6 5.6a5.6 5.6 0 0 0-4 9.8 7.2 7.2 0 0 0 1.928 2.868c.3.245.5.609.5 1.003v1a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-1"/></IconWrapper>,
            Users: (p)=><IconWrapper {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/></IconWrapper>,
            BriefcaseMedical: (p)=><IconWrapper {...p}><path d="M12 11v4"/><path d="M14 13h-4"/><path d="M16 6V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/><path d="M18 6v14"/><path d="M6 6v14"/><rect width="20" height="14" x="2" y="6" rx="2"/></IconWrapper>,
            Flag: (p)=><IconWrapper {...p}><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></IconWrapper>,
            Trash: (p)=><IconWrapper {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></IconWrapper>,
            HelpCircle: (p)=><IconWrapper {...p}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></IconWrapper>,
            Award: (p)=><IconWrapper {...p}><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></IconWrapper>,
            BarChart: (p)=><IconWrapper {...p}><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></IconWrapper>,
            Type: (p)=><IconWrapper {...p}><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" x2="15" y1="20" y2="20"/><line x1="12" x2="12" y1="4" y2="20"/></IconWrapper>,
            Hash: (p)=><IconWrapper {...p}><line x1="4" x2="20" y1="9" y2="9"/><line x1="4" x2="20" y1="15" y2="15"/><line x1="10" x2="8" y1="3" y2="21"/><line x1="16" x2="14" y1="3" y2="21"/></IconWrapper>,
            Clock: (p)=><IconWrapper {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconWrapper>,
            HeartHandshake: (p)=><IconWrapper {...p}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></IconWrapper>,
            SmilePlus: (p)=><IconWrapper {...p}><path d="M22 11v1a10 10 0 1 1-9-10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/><path d="M16 5h6"/></IconWrapper>,
            BookA: (p)=><IconWrapper {...p}><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></IconWrapper>,
            ListChecks: (p)=><IconWrapper {...p}><path d="M10 6h11"/><path d="M10 12h11"/><path d="M10 18h11"/><path d="M4 6h1"/><path d="M4 12h1"/><path d="M4 18h1"/></IconWrapper>,
            Palette: (p)=><IconWrapper {...p}><circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.093 0-.679.5-1.25 1.25-1.25H16c3.314 0 6-2.686 6-6 0-5.523-4.477-10-10-10Z"/></IconWrapper>,
            Mic: (p)=><IconWrapper {...p}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/><line x1="8" x2="16" y1="22" y2="22"/></IconWrapper>
        };

        // --- DATA ---
        const SPANISH_PHRASES = [
            "Â¡Hola! Â¿CÃ³mo estÃ¡s?", "Â¡Pura vida!", "Â¿QuÃ© onda?", "Â¡Buenos dÃ­as!", "Â¡Buenas tardes!",
            "Â¿Todo bien?", "Â¡QuÃ© padre!", "Â¡ChÃ©vere!", "Â¡Dale!", "Â¡Venga!", "Â¿QuÃ© tal?", "Â¡Bienvenido!"
        ];

        const COLORS_DATA = [
            { es: "Rojo", en: "Red", hex: "bg-red-500", emoji: "ðŸ”´" }, 
            { es: "Azul", en: "Blue", hex: "bg-blue-500", emoji: "ðŸ”µ" }, 
            { es: "Verde", en: "Green", hex: "bg-green-500", emoji: "ðŸŸ¢" },
            { es: "Amarillo", en: "Yellow", hex: "bg-yellow-400", emoji: "ðŸŸ¡" }, 
            { es: "Negro", en: "Black", hex: "bg-gray-900", emoji: "âš«" }, 
            { es: "Blanco", en: "White", hex: "bg-white text-gray-900 border", emoji: "âšª" },
            { es: "Naranja", en: "Orange", hex: "bg-orange-500", emoji: "ðŸŸ " }, 
            { es: "Morado", en: "Purple", hex: "bg-purple-600", emoji: "ðŸŸ£" }, 
            { es: "Rosa", en: "Pink", hex: "bg-pink-400", emoji: "ðŸŒ¸" },
            { es: "Gris", en: "Gray", hex: "bg-gray-500", emoji: "ðŸ©¶" }, 
            { es: "MarrÃ³n", en: "Brown", hex: "bg-amber-800", emoji: "ðŸŸ¤" }, 
            { es: "Turquesa", en: "Turquoise", hex: "bg-teal-400", emoji: "ðŸ”µ" }
        ];

        const CHARACTERS = [
            { id: 1, firstName: "Claudia", lastName: "Sheinbaum", age: 63, origin: "MÃ©xico", nationality: "Mexicana", language: "EspaÃ±ol", flag: "ðŸ‡²ðŸ‡½", job: "Presidenta" },
            { id: 2, firstName: "Sandra", lastName: "Oh", age: 54, origin: "CanadÃ¡", nationality: "Canadiense", language: "InglÃ©s", flag: "ðŸ‡¨ðŸ‡¦", job: "Actriz" },
            { id: 3, firstName: "Idris", lastName: "Elba", age: 53, origin: "Londres", nationality: "BritÃ¡nico", language: "InglÃ©s", flag: "ðŸ‡¬ðŸ‡§", job: "Actor" },
            { id: 4, firstName: "SofÃ­a", lastName: "Vergara", age: 53, origin: "Colombia", nationality: "Colombiana", language: "EspaÃ±ol", flag: "ðŸ‡¨ðŸ‡´", job: "Actriz" },
            { id: 5, firstName: "Marion", lastName: "Cotillard", age: 50, origin: "Francia", nationality: "Francesa", language: "FrancÃ©s", flag: "ðŸ‡«ðŸ‡·", job: "Actriz" },
            { id: 6, firstName: "Lionel", lastName: "Messi", age: 37, origin: "Argentina", nationality: "Argentino", language: "EspaÃ±ol", flag: "ðŸ‡¦ðŸ‡·", job: "Futbolista" },
            { id: 7, firstName: "Guillermo", lastName: "del Toro", age: 60, origin: "MÃ©xico", nationality: "Mexicano", language: "EspaÃ±ol", flag: "ðŸ‡²ðŸ‡½", job: "Director" },
            { id: 8, firstName: "JosÃ©", lastName: "AndrÃ©s", age: 55, origin: "EspaÃ±a", nationality: "EspaÃ±ol", language: "EspaÃ±ol", flag: "ðŸ‡ªðŸ‡¸", job: "Cocinero" },
            { id: 9, firstName: "Shakira", lastName: "Mebarak", age: 48, origin: "Colombia", nationality: "Colombiana", language: "EspaÃ±ol", flag: "ðŸ‡¨ðŸ‡´", job: "Cantante" },
            { id: 10, firstName: "Rafael", lastName: "Nadal", age: 38, origin: "EspaÃ±a", nationality: "EspaÃ±ol", language: "EspaÃ±ol", flag: "ðŸ‡ªðŸ‡¸", job: "Tenista" }
        ];

        const JOBS_DATA = [
            { fem: "doctora", masc: "doctor", eng: "Doctor", emoji: "ðŸ‘¨â€âš•ï¸" }, { fem: "bombera", masc: "bombero", eng: "Firefighter", emoji: "ðŸ‘¨â€ðŸš’" },
            { fem: "maestra", masc: "maestro", eng: "Teacher", emoji: "ðŸ‘¨â€ðŸ«" }, { fem: "policÃ­a", masc: "policÃ­a", eng: "Police officer", emoji: "ðŸ‘®" },
            { fem: "mesera", masc: "mesero", eng: "Waiter", emoji: "ðŸ’" }, { fem: "panadera", masc: "panadero", eng: "Baker", emoji: "ðŸ¥–" },
            { fem: "pescadera", masc: "pescadero", eng: "Fishmonger", emoji: "ðŸŸ" }, { fem: "empresaria", masc: "empresario", eng: "Businessperson", emoji: "ðŸ’¼" },
            { fem: "carnicera", masc: "carnicero", eng: "Butcher", emoji: "ðŸ¥©" }, { fem: "periodista", masc: "periodista", eng: "Journalist", emoji: "ðŸ“°" },
            { fem: "fontanera", masc: "fontanero", eng: "Plumber", emoji: "ðŸ”§" }, { fem: "diseÃ±adora", masc: "diseÃ±ador", eng: "Designer", emoji: "ðŸŽ¨" },
            { fem: "ingeniera", masc: "ingeniero", eng: "Engineer", emoji: "ðŸ‘·" }, { fem: "cantante", masc: "cantante", eng: "Singer", emoji: "ðŸŽ¤" },
            { fem: "actriz", masc: "actor", eng: "Actor", emoji: "ðŸŽ­" }, { fem: "jugadora", masc: "jugador", eng: "Player", emoji: "âš½" },
            { fem: "abogada", masc: "abogado", eng: "Lawyer", emoji: "âš–ï¸" }, { fem: "obrera", masc: "obrero", eng: "Construction Worker", emoji: "ðŸš§" },
            { fem: "conductora", masc: "conductor", eng: "Driver", emoji: "ðŸšŒ" }, { fem: "mecÃ¡nica", masc: "mecÃ¡nico", eng: "Mechanic", emoji: "ðŸ”§" },
            { fem: "estudiante", masc: "estudiante", eng: "Student", emoji: "ðŸŽ’" }, { fem: "cocinera", masc: "cocinero", eng: "Chef", emoji: "ðŸ‘¨â€ðŸ³" },
            { fem: "peluquera", masc: "peluquero", eng: "Hairdresser", emoji: "âœ‚ï¸" }, { fem: "escritora", masc: "escritor", eng: "Writer", emoji: "âœï¸" },
            { fem: "piloto", masc: "piloto", eng: "Pilot", emoji: "âœˆï¸" }, { fem: "vendedora", masc: "vendedor", eng: "Salesperson", emoji: "ðŸ›’" },
            { fem: "secretaria", masc: "secretario", eng: "Secretary", emoji: "ðŸ“‚" }, { fem: "arquitecta", masc: "arquitecto", eng: "Architect", emoji: "ðŸ“" },
            { fem: "presidenta", masc: "presidente", eng: "President", emoji: "ðŸ›ï¸" }
        ];

        const PLACES_DATA = [
            { es: "La empresa", en: "The company" }, { es: "El hospital", en: "The hospital" }, { es: "La oficina", en: "The office" },
            { es: "La clÃ­nica", en: "The clinic" }, { es: "El aeropuerto", en: "The airport" }, { es: "El supermercado", en: "The supermarket" },
            { es: "El parque", en: "The park" }, { es: "El restaurante", en: "The restaurant" }, { es: "La estaciÃ³n de bomberos", en: "The fire station" },
            { es: "La estaciÃ³n de policÃ­as", en: "The police station" }
        ];

        const COUNTRIES_DATA = [
            { country: "CanadÃ¡ ðŸ‡¨ðŸ‡¦", en: "Canada", natM: "Canadiense", natF: "Canadiense" }, 
            { country: "Estados Unidos ðŸ‡ºðŸ‡¸", en: "United States", natM: "Estadounidense", natF: "Estadounidense" },
            { country: "MÃ©xico ðŸ‡²ðŸ‡½", en: "Mexico", natM: "Mexicano", natF: "Mexicana" }, 
            { country: "Colombia ðŸ‡¨ðŸ‡´", en: "Colombia", natM: "Colombiano", natF: "Colombiana" },
            { country: "China ðŸ‡¨ðŸ‡³", en: "China", natM: "Chino", natF: "China" }, 
            { country: "Honduras ðŸ‡­ðŸ‡³", en: "Honduras", natM: "HondureÃ±o", natF: "HondureÃ±a" },
            { country: "Francia ðŸ‡«ðŸ‡·", en: "France", natM: "FrancÃ©s", natF: "Francesa" }, 
            { country: "Inglaterra ðŸ‡¬ðŸ‡§", en: "England", natM: "BritÃ¡nico", natF: "BritÃ¡nica" },
            { country: "Alemania ðŸ‡©ðŸ‡ª", en: "Germany", natM: "AlemÃ¡n", natF: "Alemana" }, 
            { country: "Italia ðŸ‡®ðŸ‡¹", en: "Italy", natM: "Italiano", natF: "Italiana" },
            { country: "Brasil ðŸ‡§ðŸ‡·", en: "Brazil", natM: "BrasileÃ±o", natF: "BrasileÃ±a" }, 
            { country: "JapÃ³n ðŸ‡¯ðŸ‡µ", en: "Japan", natM: "JaponÃ©s", natF: "Japonesa" },
            { country: "EspaÃ±a ðŸ‡ªðŸ‡¸", en: "Spain", natM: "EspaÃ±ol", natF: "EspaÃ±ola" }, 
            { country: "Argentina ðŸ‡¦ðŸ‡·", en: "Argentina", natM: "Argentino", natF: "Argentina" }
        ];

        const ALPHABET_DATA = [
            { l: "A a", s: "ah", tip: "Like 'fAther'" }, { l: "B b", s: "beh", tip: "Softer than English B" }, { l: "C c", s: "seh / keh", tip: "Hard C before a,o,u; Soft before e,i" },
            { l: "D d", s: "deh", tip: "Tongue against teeth" }, { l: "E e", s: "eh", tip: "Like 'Elephant'" }, { l: "F f", s: "eff-eh", tip: "Similar to English" },
            { l: "G g", s: "heh / geh", tip: "Hard G before a,o,u; H sound before e,i" }, { l: "H h", s: "ah-cheh", tip: "ALWAYS SILENT" }, { l: "I i", s: "ee", tip: "Like 'machIne'" },
            { l: "J j", s: "ho-ta", tip: "Strong H sound, like 'Ham'" }, { l: "K k", s: "kah", tip: "Rare in Spanish" }, { l: "L l", s: "eh-leh", tip: "Similar to English" },
            { l: "LL ll", s: "yeh", tip: "Like 'Y' in 'Yes'" }, { l: "M m", s: "eh-meh", tip: "Similar to English" }, { l: "N n", s: "eh-neh", tip: "Similar to English" },
            { l: "Ã‘ Ã±", s: "eh-nyeh", tip: "Like 'oNion' or 'canyon'" }, { l: "O o", s: "oh", tip: "Round O, shorter than 'boat'" }, { l: "P p", s: "peh", tip: "Less explosive than English P" },
            { l: "Q q", s: "koo", tip: "Always followed by u (que, qui)" }, { l: "R r", s: "eh-reh", tip: "Tapped R (like butter)" }, { l: "RR rr", s: "errr-reh", tip: "Rolled R" },
            { l: "S s", s: "eh-seh", tip: "Similar to English" }, { l: "T t", s: "teh", tip: "Tongue against teeth" }, { l: "U u", s: "oo", tip: "Like 'rUle'" },
            { l: "V v", s: "veh", tip: "Sounds mostly like B" }, { l: "W w", s: "doble-u", tip: "Rare, used in foreign words" }, { l: "X x", s: "eh-kees", tip: "Varies (taxi vs MÃ©xico)" },
            { l: "Y y", s: "ee-grie-ga", tip: "Like 'ee' or 'y' in 'yellow'" }, { l: "Z z", s: "seh-ta", tip: "Like S in Latin America" },
        ];

        const NUMBER_DATA = [
            { n: "0", s: "cero" }, { n: "1", s: "uno" }, { n: "2", s: "dos" }, { n: "3", s: "tres" }, { n: "4", s: "cuatro" }, { n: "5", s: "cinco" }, { n: "6", s: "seis" }, { n: "7", s: "siete" }, { n: "8", s: "ocho" }, { n: "9", s: "nueve" }, { n: "10", s: "diez" },
            { n: "11", s: "once" }, { n: "12", s: "doce" }, { n: "13", s: "trece" }, { n: "14", s: "catorce" }, { n: "15", s: "quince" }, { n: "20", s: "veinte" }, { n: "30", s: "treinta" }, { n: "40", s: "cuarenta" }, { n: "50", s: "cincuenta" },
            { n: "60", s: "sesenta" }, { n: "70", s: "setenta" }, { n: "80", s: "ochenta" }, { n: "90", s: "noventa" }, { n: "100", s: "cien" }, { n: "1000", s: "mil" }
        ];

        const CALENDAR_DATA = {
            days: [{ es: "Lunes", en: "Monday" }, { es: "Martes", en: "Tuesday" }, { es: "MiÃ©rcoles", en: "Wednesday" }, { es: "Jueves", en: "Thursday" }, { es: "Viernes", en: "Friday" }, { es: "SÃ¡bado", en: "Saturday" }, { es: "Domingo", en: "Sunday" }],
            months: [{ es: "Enero", en: "January" }, { es: "Febrero", en: "February" }, { es: "Marzo", en: "March" }, { es: "Abril", en: "April" }, { es: "Mayo", en: "May" }, { es: "Junio", en: "June" }, { es: "Julio", en: "July" }, { es: "Agosto", en: "August" }, { es: "Septiembre", en: "September" }, { es: "Octubre", en: "October" }, { es: "Noviembre", en: "November" }, { es: "Diciembre", en: "December" }]
        };

        const FEELINGS_DATA = [
            { es: "Estoy bien", en: "I am fine", emoji: "ðŸ™‚" }, { es: "Estoy mal", en: "I am doing bad", emoji: "ðŸ™" }, { es: "Estoy feliz", en: "I am happy", emoji: "ðŸ˜" }, { es: "Estoy triste", en: "I am sad", emoji: "ðŸ˜¢" },
            { es: "Estoy cansado(a)", en: "I am tired", emoji: "ðŸ¥±" }, { es: "Estoy enfermo(a)", en: "I am sick", emoji: "ðŸ¤’" }, { es: "Estoy mÃ¡s o menos", en: "I am so-so", emoji: "ðŸ˜" }, { es: "Tengo calor", en: "I am hot", emoji: "ðŸ¥µ" },
            { es: "Tengo frÃ­o", en: "I am cold", emoji: "ðŸ¥¶" }, { es: "Tengo hambre", en: "I am hungry", emoji: "ðŸ˜‹" }, { es: "Tengo sed", en: "I am thirsty", emoji: "ðŸ¥¤" }, { es: "Tengo sueÃ±o", en: "I am sleepy", emoji: "ðŸ˜´" },
            { es: "Tengo miedo", en: "I am scared", emoji: "ðŸ˜±" }, { es: "Estoy enojado(a)", en: "I am angry", emoji: "ðŸ˜¡" }, { es: "Estoy aburrido(a)", en: "I am bored", emoji: "ðŸ˜‘" }, { es: "Estoy emocionado(a)", en: "I am excited", emoji: "ðŸ¤©" },
            { es: "Estoy nervioso(a)", en: "I am nervous", emoji: "ðŸ˜¬" }, { es: "Estoy preocupado(a)", en: "I am worried", emoji: "ðŸ˜Ÿ" },
        ];

        const GREETINGS_DATA = [
            { es: "Hola", en: "Hello", emoji: "ðŸ‘‹" }, { es: "Buenos dÃ­as", en: "Good morning", emoji: "ðŸŒ…" }, { es: "Buenas tardes", en: "Good afternoon", emoji: "â˜€ï¸" }, { es: "Buenas noches", en: "Good evening/night", emoji: "ðŸŒ™" },
            { es: "AdiÃ³s", en: "Goodbye", emoji: "ðŸ‘‹" }, { es: "Hasta luego", en: "See you later", emoji: "ðŸ•" }, { es: "Hasta maÃ±ana", en: "See you tomorrow", emoji: "ðŸŒ…" }, { es: "Mucho gusto", en: "Nice to meet you", emoji: "ðŸ¤" },
            { es: "Buena suerte", en: "Good luck", emoji: "ðŸ€" }, { es: "Â¡Genial!", en: "Awesome!", emoji: "ðŸ˜Ž" }, { es: "Â¡SÃºper!", en: "Super!", emoji: "ðŸ¦¸" }, { es: "Â¡QuÃ© padre!", en: "Cool/Sweet!", emoji: "ðŸ¬" },
            { es: "Bienvenido", en: "Welcome", emoji: "ðŸ " }, { es: "Â¿QuÃ© tal?", en: "How's it going?", emoji: "ðŸ¤·" }
        ];

        const CONJUGATION_DATA = [
            { v: "Ser", t: "To Be (Identity)", c: ["Soy", "Eres", "Es", "Somos", "Son"] }, { v: "Estar", t: "To Be (State)", c: ["Estoy", "EstÃ¡s", "EstÃ¡", "Estamos", "EstÃ¡n"] }, { v: "Tener", t: "To Have", c: ["Tengo", "Tienes", "Tiene", "Tenemos", "Tienen"] },
            { v: "Vivir", t: "To Live", c: ["Vivo", "Vives", "Vive", "Vivimos", "Viven"] }, { v: "Hablar", t: "To Speak", c: ["Hablo", "Hablas", "Habla", "Hablamos", "Hablan"] }, { v: "Llamarse", t: "To Call Oneself", c: ["Me llamo", "Te llamas", "Se llama", "Nos llamamos", "Se llaman"] },
            { v: "Apellidarse", t: "To Have Surname", c: ["Me apellido", "Te apellidas", "Se apellida", "Nos apellidamos", "Se apellidan"] },
            { v: "Trabajar", t: "To Work", c: ["Trabajo", "Trabajas", "Trabaja", "Trabajamos", "Trabajan"] }
        ];

        const generateVocabBank = () => {
            let base = [];
            JOBS_DATA.forEach(j => { base.push({ es: j.masc, en: j.eng }); base.push({ es: j.fem, en: j.eng }); });
            PLACES_DATA.forEach(p => base.push({ es: p.es, en: p.en }));
            FEELINGS_DATA.forEach(f => base.push({ es: f.es, en: f.en }));
            GREETINGS_DATA.forEach(g => base.push({ es: g.es, en: g.en }));
            CALENDAR_DATA.days.forEach(d => base.push({ es: d.es, en: d.en }));
            CALENDAR_DATA.months.forEach(m => base.push({ es: m.es, en: m.en }));
            COUNTRIES_DATA.forEach(c => { base.push({es: c.country.split(' ')[0], en: c.en}); base.push({es: c.natM, en: "National (M)"}); });
            return base;
        };
        
        // --- QUIZ HELPERS (IMPROVED) ---

        const normalize = (txt) => txt ? txt.toLowerCase().trim() : "";

        // Fallback for general distractors (random from vocab)
        const getDistractors = (correctAnswer, count) => {
            const vocab = generateVocabBank();
            // Filter out correct answer and similar items
            const others = vocab.filter(v => v.en !== correctAnswer && v.es !== correctAnswer);
            const shuffled = others.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count).map(v => v.en);
        };

        // New helper to get smarter distractors from the SAME category if possible
        const getSmartDistractors = (correctAnswer, pool) => {
            if (!pool) return ["OpciÃ³n A", "OpciÃ³n B"];
            const correctNorm = normalize(correctAnswer);
            
            // Safe extraction: handle strings or objects with typical properties
            const stringPool = pool.map(item => {
                if (typeof item === 'string') return item;
                if (!item) return "";
                // Try common properties in our data structures
                return item.es || item.masc || item.desc || item.name || item.en || "";
            }).filter(s => s !== "");

            const potential = stringPool.filter(val => normalize(val) !== correctNorm);
            return potential.sort(() => 0.5 - Math.random()).slice(0, 2);
        };

        // --- COMPONENTS ---
        const LessonQuiz = ({ onComplete, questionCount, pool }) => {
            const [questions, setQuestions] = useState([]);
            const [currentQ, setCurrentQ] = useState(0);
            const [score, setScore] = useState(0);
            const [finished, setFinished] = useState(false);
            const [selected, setSelected] = useState(null); 
            const [feedback, setFeedback] = useState(null);

            useEffect(() => {
                let p = [...pool].sort(() => 0.5 - Math.random());
                if (p.length > questionCount) p = p.slice(0, questionCount);
                setQuestions(p);
            }, [pool, questionCount]);

            const handleMC = (opt) => { 
                if (selected) return; 
                setSelected(opt); 
                const q = questions[currentQ]; 
                const correct = opt === q.a;
                if (correct) setScore(s => s+1); 
                
                // Detailed Feedback
                const msg = correct 
                    ? "Â¡Correcto! " + (q.exp || "")
                    : "Incorrecto. " + (q.exp || `La respuesta correcta es: ${q.a}`);
                
                setFeedback({correct, text: msg});
                
                // Longer timeout to read explanation
                setTimeout(() => nextQ(), 3500); 
            };

            const nextQ = () => { 
                setSelected(null); 
                setFeedback(null); 
                if (currentQ < questions.length - 1) setCurrentQ(c => c+1); 
                else setFinished(true); 
            };

            if (questions.length === 0) return <div>Cargando...</div>;
            if (finished) return (
                <div className="p-6 text-center space-y-4">
                    <div className="text-6xl animate-bounce">ðŸŽ‰</div>
                    <h3 className="text-xl font-bold">Â¡Prueba Terminada!</h3>
                    <p className="text-gray-300">Puntaje: {score} / {questions.length}</p>
                    <button onClick={onComplete} className="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl">Volver a LecciÃ³n</button>
                </div>
            );

            const q = questions[currentQ];
            return (
                <div className="space-y-4">
                    <div className="flex justify-between text-xs text-gray-400 font-mono"><span>P: {currentQ + 1}/{questions.length}</span><span>Pts: {score}</span></div>
                    <div className="bg-gray-800 p-4 rounded-xl border border-gray-700 min-h-[100px] flex items-center justify-center text-center"><p className="text-lg font-medium">{q.q}</p></div>
                    {q.type === 'mc' && (
                        <div className="grid gap-2">{q.opts.map(opt => { 
                            let bg = "bg-gray-800 hover:bg-gray-700"; 
                            if (selected) { 
                                if (opt === q.a) bg = "bg-green-600 border-green-400"; 
                                else if (opt === selected) bg = "bg-red-600 border-red-400"; 
                                else bg = "opacity-40"; 
                            } 
                            return (<button key={opt} onClick={() => handleMC(opt)} className={`${bg} p-3 rounded-lg font-bold transition-all border border-gray-700 text-sm capitalize`}>{opt}</button>); 
                        })}</div>
                    )}
                    {feedback && <div className={`p-4 rounded-xl text-center text-sm font-bold animate-fade-in border ${feedback.correct ? 'text-green-200 bg-green-900/40 border-green-500' : 'text-red-200 bg-red-900/40 border-red-500'}`}>{feedback.text}</div>}
                </div>
            );
        };

        const AlphabetLesson = ({ onComplete }) => (
            <div className="p-6 max-w-md mx-auto pb-24 space-y-4">
                <div className="bg-gray-800 p-4 rounded-xl mb-4"><h3 className="font-bold text-lg mb-2">Claves de PronunciaciÃ³n</h3><ul className="text-sm text-gray-300 list-disc list-inside"><li><b>H</b> es siempre silenciosa.</li><li><b>LL</b> suena como 'Y'.</li><li><b>Ã‘</b> suena como 'ni' en 'onion'.</li></ul></div>
                <div className="grid grid-cols-1 gap-2">{ALPHABET_DATA.map((item, idx) => (<div key={idx} className="bg-gray-800 p-3 rounded-lg border border-gray-700 flex justify-between items-center"><span className="text-xl font-black text-purple-400 w-12">{item.l}</span><div className="text-right"><span className="block text-white font-medium">{item.s}</span><span className="text-xs text-gray-500 italic">{item.tip}</span></div></div>))}</div>
                <button onClick={onComplete} className="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-4 rounded-2xl shadow-lg mt-4">Volver</button>
            </div>
        );

        const NumbersLesson = ({ onComplete }) => (
            <div className="p-6 max-w-md mx-auto pb-24 space-y-4">
                <div className="grid grid-cols-2 gap-3">{NUMBER_DATA.map((item, idx) => (<div key={idx} className="bg-gray-800 p-3 rounded-lg border border-gray-700 flex justify-between items-center"><span className="text-xl font-bold text-blue-400">{item.n}</span><span className="text-white capitalize">{item.s}</span></div>))}</div>
                <button onClick={onComplete} className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-2xl shadow-lg mt-4">Volver</button>
            </div>
        );

        const Dashboard = ({ onSelectLesson }) => {
            const [greeting, setGreeting] = useState("");
            useEffect(() => setGreeting(SPANISH_PHRASES[Math.floor(Math.random() * SPANISH_PHRASES.length)]), []);

            const lessons = [
                { id: 'alphabet', title: 'El Alfabeto', desc: 'PronunciaciÃ³n y sonidos.', icon: <Icons.Type size={24} />, color: 'bg-purple-600' },
                { id: 'intro', title: 'Presentarse', desc: 'Nombre, edad, origen.', icon: <Icons.HeartHandshake size={24} />, color: 'bg-pink-500' },
                { id: 'interview', title: 'Entrevista', desc: 'Preguntas y Respuestas clave.', icon: <Icons.Mic size={24} />, color: 'bg-cyan-600' },
                { id: 'pronouns', title: 'Pronombres: Su/Se', desc: 'Su vs Se, Tu vs Te, Nos.', icon: <Icons.Users size={24} />, color: 'bg-indigo-500' },
                { id: 'feelings', title: 'Saludos y Sentimientos', desc: 'Hola, adiÃ³s y emociones.', icon: <Icons.SmilePlus size={24} />, color: 'bg-yellow-500' },
                { id: 'numbers', title: 'Los NÃºmeros', desc: 'Contar del 0 al 1000.', icon: <Icons.Hash size={24} />, color: 'bg-blue-500' },
                { id: 'colors', title: 'Colores', desc: 'Rojo, Azul, Verde...', icon: <Icons.Palette size={24} />, color: 'bg-red-500' },
                { id: 'calendar', title: 'DÃ­as y Meses', desc: 'Calendario y fechas.', icon: <Icons.Clock size={24} />, color: 'bg-green-600' },
                { id: 'characters', title: 'Personajes Famosos', desc: 'Identifica nombre y origen.', icon: <Icons.Users size={24} />, color: 'bg-indigo-600' },
                { id: 'jobs', title: 'Profesiones y Lugares', desc: 'Trabajos y lugares.', icon: <Icons.BriefcaseMedical size={24} />, color: 'bg-teal-600' },
                { id: 'nationalities', title: 'Nacionalidades', desc: 'PaÃ­ses y plurales.', icon: <Icons.Flag size={24} />, color: 'bg-rose-600' },
                { id: 'verbs', title: 'Verbos: Ser/Estar/Tener', desc: 'Reglas y Usos.', icon: <Icons.BrainCircuit size={24} />, color: 'bg-emerald-600' },
                { id: 'conjugations', title: 'ConjugaciÃ³n de Verbos', desc: 'Tablas y PrÃ¡ctica.', icon: <Icons.ListChecks size={24} />, color: 'bg-cyan-600' },
                { id: 'weather', title: 'El Clima Completo', desc: 'TÃ©rminos del tiempo.', icon: <Icons.Sun size={24} />, color: 'bg-orange-500' },
                { id: 'vocabmix', title: 'Vocabulario Mix', desc: 'Flashcards de todo.', icon: <Icons.BookA size={24} />, color: 'bg-pink-600' },
                { id: 'finalquiz', title: 'Examen Final', desc: '25 preguntas aleatorias.', icon: <Icons.Award size={24} />, color: 'bg-yellow-600' },
            ];

            return (
                <div className="p-6 max-w-md mx-auto space-y-6 pb-32">
                    <div className="space-y-1">
                        <h1 className="text-3xl font-bold bg-gradient-to-r from-pink-400 to-indigo-400 bg-clip-text text-transparent">Hola, estudiante</h1>
                        <p className="text-gray-400">{greeting}</p>
                    </div>
                    <div className="grid gap-4">
                        {lessons.map(l => (
                            <button key={l.id} onClick={() => onSelectLesson(l.id)} className="relative overflow-hidden group rounded-2xl bg-gray-800 p-1 text-left border border-gray-700">
                                <div className={`absolute top-0 right-0 p-3 opacity-20 ${l.color} blur-xl w-24 h-24 rounded-full -mr-10 -mt-10`}></div>
                                <div className="relative p-5 flex items-center justify-between">
                                    <div className="space-y-2">
                                        <div className={`w-10 h-10 rounded-lg ${l.color} flex items-center justify-center text-white shadow-lg`}>{l.icon}</div>
                                        <div><h3 className="font-bold text-lg text-white">{l.title}</h3><p className="text-sm text-gray-400">{l.desc}</p></div>
                                    </div>
                                    <Icons.ChevronRight size={20} className="text-gray-600" />
                                </div>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const InterviewLesson = ({ onComplete }) => {
            const QUESTIONS = [
                { topic: "Nombre", tu: "Â¿CÃ³mo te llamas?", ud: "Â¿CÃ³mo se llama?", ans: "Me llamo... / Soy..." },
                { topic: "Apellido", tu: "Â¿CÃ³mo te apellidas?", ud: "Â¿CÃ³mo se apellida?", ans: "Me apellido..." },
                { topic: "Nacionalidad", tu: "Â¿De dÃ³nde eres?", ud: "Â¿De dÃ³nde es?", ans: "Soy de... / Soy..." },
                { topic: "Edad", tu: "Â¿CuÃ¡ntos aÃ±os tienes?", ud: "Â¿CuÃ¡ntos aÃ±os tiene?", ans: "Tengo ___ aÃ±os" },
                { topic: "ProfesiÃ³n", tu: "Â¿A quÃ© te dedicas?", ud: "Â¿A quÃ© se dedica?", ans: "Soy..." },
                { topic: "Lenguas", tu: "Â¿QuÃ© idioma hablas?", ud: "Â¿QuÃ© idioma habla?", ans: "Hablo..." },
                { topic: "Domicilio", tu: "Â¿DÃ³nde vives?", ud: "Â¿DÃ³nde vive?", ans: "Vivo en..." },
                { topic: "Lugar de Trabajo", tu: "Â¿DÃ³nde trabajas?", ud: "Â¿DÃ³nde trabaja?", ans: "Trabajo en..." },
                { topic: "TelÃ©fono", tu: "Â¿Tienes nÃºmero de telÃ©fono?", ud: "Â¿Tiene nÃºmero de telÃ©fono?", ans: "SÃ­, es el... / No" },
                { topic: "Correo", tu: "Â¿Tienes correo electrÃ³nico?", ud: "Â¿Tiene correo electrÃ³nico?", ans: "SÃ­, es el... / No" }
            ];

            return (
                <div className="p-6 max-w-md mx-auto pb-24 space-y-6">
                    <div className="bg-gray-800 border border-cyan-500/30 p-4 rounded-xl">
                        <div className="flex justify-between items-end border-b border-gray-700 pb-2 mb-4">
                            <h3 className="font-bold text-cyan-400 text-lg">Entrevista</h3>
                            <span className="text-xs text-gray-400 italic">TÃº (Informal) vs Usted (Formal)</span>
                        </div>
                        
                        <div className="space-y-4">
                            {QUESTIONS.map((item, i) => (
                                <div key={i} className="bg-gray-900/50 p-3 rounded-lg border border-gray-700/50">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="text-xs font-bold text-gray-500 uppercase tracking-wider">{item.topic}</span>
                                        <span className="text-xs text-cyan-300 bg-cyan-900/30 px-2 py-0.5 rounded border border-cyan-500/20">{item.ans}</span>
                                    </div>
                                    <div className="space-y-1.5">
                                        <div className="flex gap-3 text-sm">
                                            <span className="text-gray-500 w-6 font-bold text-right shrink-0">TÃº:</span>
                                            <span className="text-white">{item.tu}</span>
                                        </div>
                                        <div className="flex gap-3 text-sm">
                                            <span className="text-indigo-400 w-6 font-bold text-right shrink-0">Ud:</span>
                                            <span className="text-indigo-100">{item.ud}</span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="bg-gray-800 border border-green-500/30 p-4 rounded-xl">
                        <h3 className="font-bold text-green-400 mb-3 text-lg flex items-center gap-2"><Icons.MapPin size={18}/> Detalles de Vivir</h3>
                        <div className="space-y-3">
                            <div className="p-3 bg-gray-900 rounded-lg">
                                <p className="text-xs text-gray-400 mb-1">Cerca / Lejos</p>
                                <p className="text-white">Vivo <span className="text-green-400 font-bold">cerca del</span> parque.</p>
                                <p className="text-white">Vivo <span className="text-red-400 font-bold">lejos de</span> la oficina.</p>
                            </div>
                            <div className="grid grid-cols-2 gap-2 text-sm">
                                <div className="bg-gray-900 p-2 rounded">
                                    <span className="block text-gray-500 text-xs">Calle</span>
                                    <span className="text-white">La calle...</span>
                                </div>
                                <div className="bg-gray-900 p-2 rounded">
                                    <span className="block text-gray-500 text-xs">Barrio</span>
                                    <span className="text-white">El barrio...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-gray-800 border border-purple-500/30 p-4 rounded-xl">
                        <h3 className="font-bold text-purple-400 mb-3 text-lg">Correo ElectrÃ³nico</h3>
                        <div className="grid grid-cols-4 gap-2 text-center mb-3">
                            <div className="bg-gray-900 rounded p-2">
                                <div className="text-xl font-mono text-purple-400 mb-1">@</div>
                                <span className="text-[10px] text-gray-400 block leading-tight">arroba</span>
                            </div>
                            <div className="bg-gray-900 rounded p-2">
                                <div className="text-xl font-mono text-purple-400 mb-1">.</div>
                                <span className="text-[10px] text-gray-400 block leading-tight">punto</span>
                            </div>
                            <div className="bg-gray-900 rounded p-2">
                                <div className="text-xl font-mono text-purple-400 mb-1">_</div>
                                <span className="text-[10px] text-gray-400 block leading-tight">guion bajo</span>
                            </div>
                            <div className="bg-gray-900 rounded p-2">
                                <div className="text-xl font-mono text-purple-400 mb-1">-</div>
                                <span className="text-[10px] text-gray-400 block leading-tight">guion</span>
                            </div>
                        </div>
                        <div className="bg-gray-900 p-3 rounded text-center font-mono text-sm text-gray-300 break-all">
                            nombre<span className="text-purple-400">-</span>apellido<span className="text-purple-400">@</span>gmail<span className="text-purple-400">.</span>com
                        </div>
                    </div>

                    <button onClick={onComplete} className="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-4 rounded-2xl shadow-lg">Volver</button>
                </div>
            );
        };

        const ColorsLesson = ({ onComplete }) => {
            const [mode, setMode] = useState('learn');
            const quizPool = useMemo(() => {
                return COLORS_DATA.map(c => ({
                    type: 'mc',
                    q: `Â¿QuÃ© color es ${c.emoji}?`,
                    a: c.es,
                    opts: [c.es, ...getSmartDistractors(c.es, COLORS_DATA)].sort(()=>0.5-Math.random()),
                    exp: `${c.emoji} es ${c.es} (${c.en})`
                }));
            }, []);

            const ColorCard = ({ c }) => {
                const [flipped, setFlipped] = useState(false);
                return (
                    <div className={`relative h-24 cursor-pointer perspective-1000 group`} onClick={() => setFlipped(!flipped)}>
                        <div className={`w-full h-full relative preserve-3d flip-card-inner ${flipped ? 'rotate-y-180' : ''}`}>
                            {/* Front: Spanish + Color */}
                            {/* z-index toggle: Front is z-10 normally, z-0 when flipped. */}
                            <div style={{backfaceVisibility: 'hidden', WebkitBackfaceVisibility: 'hidden'}} className={`absolute inset-0 ${c.hex} rounded-2xl flex flex-col items-center justify-center shadow-lg ${flipped ? 'z-0' : 'z-10'}`}>
                                <div className="absolute inset-0 bg-black/10 group-hover:bg-transparent transition-all rounded-2xl"></div>
                                <span className="relative font-black text-xl text-white drop-shadow-md z-10">{c.es}</span>
                            </div>
                            {/* Back: English */}
                            {/* z-index toggle: Back is z-0 normally, z-10 when flipped. */}
                            <div style={{backfaceVisibility: 'hidden', WebkitBackfaceVisibility: 'hidden'}} className={`absolute inset-0 bg-gray-800 rounded-2xl border border-gray-600 flex flex-col items-center justify-center rotate-y-180 ${flipped ? 'z-10' : 'z-0'}`}>
                                <span className="font-bold text-lg text-white">{c.en}</span>
                            </div>
                        </div>
                    </div>
                );
            };

            if(mode === 'quiz') return <div className="p-6 max-w-md mx-auto pb-24"><LessonQuiz pool={quizPool} questionCount={10} onComplete={() => setMode('learn')} /></div>;

            return (
                <div className="p-6 max-w-md mx-auto pb-24">
                    <h2 className="text-2xl font-bold mb-4 text-white">Colores</h2>
                    <div className="grid grid-cols-2 gap-3 mb-6">
                        {COLORS_DATA.map((c, i) => (
                            <ColorCard key={i} c={c} />
                        ))}
                    </div>
                    <button onClick={() => setMode('quiz')} className="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-4 rounded-2xl shadow-lg mb-4">Prueba de Colores</button>
                    <button onClick={onComplete} className="w-full border border-gray-600 text-gray-400 font-bold py-3 rounded-2xl">Volver</button>
                </div>
            );
        };

        const WeatherLesson = ({ onComplete }) => {
             const [mode, setMode] = useState('learn');
             
             const items = [
                { name: 'EstÃ¡ soleado', desc: 'It is sunny', icon: <Icons.Sun className="text-yellow-400" size={32}/> },
                { name: 'EstÃ¡ nublado', desc: 'It is cloudy', icon: <Icons.Cloud className="text-gray-400" size={32}/> },
                { name: 'EstÃ¡ parcialmente nublado', desc: 'It is partly cloudy', icon: <Icons.Cloud className="text-gray-400/80" size={32}/> },
                { name: 'EstÃ¡ despejado', desc: 'It is clear', icon: <Icons.Sun className="text-orange-200" size={32}/> },
                { name: 'EstÃ¡ lloviendo', desc: 'It is raining', icon: <Icons.CloudRain className="text-blue-400" size={32}/> },
                { name: 'La lluvia', desc: 'The rain', icon: <Icons.CloudRain className="text-blue-300" size={32}/> },
                { name: 'EstÃ¡ nevando', desc: 'It is snowing', icon: <Icons.Snowflake className="text-white" size={32}/> },
                { name: 'La nieve', desc: 'The snow', icon: <Icons.Snowflake className="text-white/80" size={32}/> },
                { name: 'Hace calor', desc: 'It is hot', icon: <Icons.Thermometer className="text-red-500" size={32}/> },
                { name: 'Hace frÃ­o', desc: 'It is cold', icon: <Icons.Thermometer className="text-blue-500" size={32}/> },
                { name: 'Hace viento', desc: 'It is windy', icon: <Icons.Wind className="text-blue-200" size={32}/> },
                { name: 'Hace buen tiempo', desc: 'The weather is good', icon: <Icons.Smile className="text-green-400" size={32}/> },
                { name: 'Hace mal tiempo', desc: 'The weather is bad', icon: <Icons.Frown className="text-red-400" size={32}/> },
                // Extra words
                { name: 'La tormenta', desc: 'The storm', icon: <Icons.Zap className="text-purple-400" size={32}/> },
                { name: 'El relÃ¡mpago', desc: 'The lightning', icon: <Icons.Zap className="text-yellow-200" size={32}/> },
                { name: 'HÃºmedo', desc: 'Humid', icon: <Icons.Cloud className="text-blue-200" size={32}/> },
                { name: 'Seco', desc: 'Dry', icon: <Icons.Sun className="text-orange-300" size={32}/> },
                { name: 'El arcoÃ­ris', desc: 'The rainbow', icon: <Icons.Smile className="text-pink-400" size={32}/> }
            ];

            const WeatherCard = ({ item }) => {
                const [flipped, setFlipped] = useState(false);
                return (
                    <div className={`relative h-28 cursor-pointer perspective-1000 group ${flipped ? 'flipped' : ''}`} onClick={() => setFlipped(!flipped)}>
                        <div className={`w-full h-full relative preserve-3d flip-card-inner`}>
                            <div className="absolute inset-0 bg-gray-800 rounded-2xl border border-gray-700 flex flex-col items-center justify-center backface-hidden">
                                {item.icon}
                                <span className="font-bold text-sm mt-2 text-center px-1">{item.name}</span>
                            </div>
                            <div className="absolute inset-0 bg-orange-900/40 rounded-2xl border border-orange-500 flex flex-col items-center justify-center backface-hidden rotate-y-180">
                                <span className="font-bold text-sm text-orange-200 text-center px-1">{item.desc}</span>
                            </div>
                        </div>
                    </div>
                );
            };

            const quizPool = useMemo(() => {
                const base = items.map(item => ({
                     type: 'mc',
                     q: `En inglÃ©s, "${item.name}" significa...`,
                     a: item.desc,
                     opts: [item.desc, ...getSmartDistractors(item.desc, items)].sort(() => 0.5 - Math.random()),
                     exp: `${item.name} = ${item.desc}`
                }));
                return base; // Using smart distractors directly
            }, []);

            if (mode === 'quiz') return (
                <div className="p-6 max-w-md mx-auto pb-24">
                    <LessonQuiz pool={quizPool} questionCount={10} onComplete={() => setMode('learn')} />
                </div>
            );

            return (
                <div className="p-6 max-w-md mx-auto pb-24">
                     <div className="mb-6 bg-gray-800 p-4 rounded-xl border-l-4 border-indigo-500">
                        <h3 className="font-bold text-white mb-2">GramÃ¡tica:</h3>
                        <p className="text-gray-400 text-sm"><b>EstÃ¡</b>: CondiciÃ³n visual (nublado, soleado).</p>
                        <p className="text-gray-400 text-sm"><b>Hace</b>: SensaciÃ³n/Temperatura (calor, frÃ­o, viento).</p>
                        <p className="text-gray-400 text-sm"><b>Hay</b>: Existencia (niebla, tormenta).</p>
                    </div>
                    <div className="grid grid-cols-2 gap-3 mb-6">{items.map((it, idx) => <WeatherCard key={idx} item={it} />)}</div>
                    <button onClick={() => setMode('quiz')} className="w-full bg-orange-600 hover:bg-orange-500 text-white font-bold py-4 rounded-2xl shadow-lg mb-4">Tomar Prueba</button>
                    <button onClick={onComplete} className="w-full border border-gray-600 text-gray-400 font-bold py-3 rounded-2xl">Volver</button>
                </div>
            );
        };

        const CalendarLesson = ({ onComplete }) => {
            const [mode, setMode] = useState('learn');

            const dateStr = useMemo(() => {
                const today = new Date();
                const dayName = new Intl.DateTimeFormat('es-ES', { weekday: 'long' }).format(today);
                const dayNum = today.getDate();
                const month = new Intl.DateTimeFormat('es-ES', { month: 'long' }).format(today);
                const year = today.getFullYear();
                // Manually construct to ensure "del" usage
                const str = `${dayName} ${dayNum} de ${month} del ${year}`;
                return str.charAt(0).toUpperCase() + str.slice(1);
            }, []);

            const FlipCard = ({ front, back, colorBorder }) => {
                const [flipped, setFlipped] = useState(false);
                return (
                    <div className={`relative h-14 cursor-pointer perspective-1000 group ${flipped ? 'flipped' : ''}`} onClick={() => setFlipped(!flipped)}>
                        <div className={`w-full h-full relative preserve-3d flip-card-inner`}>
                            <div className={`absolute inset-0 bg-gray-800 p-3 rounded-lg border-l-4 ${colorBorder} flex items-center justify-center backface-hidden`}><span className="text-white font-bold">{front}</span></div>
                            <div className={`absolute inset-0 bg-gray-700 p-3 rounded-lg border-l-4 ${colorBorder} flex items-center justify-center backface-hidden rotate-y-180`}><span className="text-gray-200">{back}</span></div>
                        </div>
                    </div>
                );
            };

            const quizPool = useMemo(() => {
                const dayQs = CALENDAR_DATA.days.map(d => ({
                    type: 'mc',
                    q: `Â¿QuÃ© dÃ­a es "${d.es}"?`,
                    a: d.en,
                    opts: [d.en, ...getSmartDistractors(d.en, CALENDAR_DATA.days)].sort(()=>0.5-Math.random()),
                    exp: `${d.es} is ${d.en}`
                }));
                const monthQs = CALENDAR_DATA.months.map(m => ({
                    type: 'mc',
                    q: `Â¿QuÃ© mes es "${m.es}"?`,
                    a: m.en,
                    opts: [m.en, ...getSmartDistractors(m.en, CALENDAR_DATA.months)].sort(()=>0.5-Math.random()),
                    exp: `${m.es} is ${m.en}`
                }));
                return [...dayQs, ...monthQs].sort(() => 0.5 - Math.random());
            }, []);

            if (mode === 'quiz') return <div className="p-6 max-w-md mx-auto pb-24"><LessonQuiz pool={quizPool} questionCount={10} onComplete={() => setMode('learn')} /></div>;

            return (
                <div className="p-6 max-w-md mx-auto pb-24 space-y-6">
                    <div className="bg-gray-800 border border-green-500/30 p-4 rounded-xl text-center shadow-lg">
                        <div className="text-xs text-green-400 font-bold uppercase tracking-wider mb-1">Fecha de hoy</div>
                        <div className="text-xl font-bold text-white capitalize">{dateStr}</div>
                    </div>

                    <div><h3 className="font-bold text-green-400 mb-3 uppercase tracking-wider">DÃ­as de la Semana</h3><div className="grid grid-cols-1 gap-2">{CALENDAR_DATA.days.map((d, i) => <FlipCard key={i} front={d.es} back={d.en} colorBorder="border-green-500" />)}</div></div>
                    <div><h3 className="font-bold text-green-400 mb-3 uppercase tracking-wider">Meses del AÃ±o</h3><div className="grid grid-cols-2 gap-2">{CALENDAR_DATA.months.map((m, i) => <FlipCard key={i} front={m.es} back={m.en} colorBorder="border-blue-500" />)}</div></div>
                    <button onClick={() => setMode('quiz')} className="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-2xl shadow-lg mt-4">Prueba de Calendario</button>
                    <button onClick={onComplete} className="w-full border border-gray-600 text-gray-400 font-bold py-3 rounded-2xl">Volver</button>
                </div>
            );
        };

        const IntroLesson = ({ onComplete }) => {
            const [mode, setMode] = useState('learn');
            const [tab, setTab] = useState('first'); 
            
            const firstPerson = [
                { q: "Â¿CÃ³mo te llamas?", a: "Me llamo...", l: "Name" },
                { q: "Â¿CÃ³mo te apellidas?", a: "Me apellido...", l: "Last Name" },
                { q: "Â¿De dÃ³nde eres?", a: "Soy de...", l: "Origin" },
                { q: "Â¿CuÃ¡ntos aÃ±os tienes?", a: "Tengo ... aÃ±os.", l: "Age" },
                { q: "Â¿A quÃ© te dedicas?", a: "Soy... / Trabajo...", l: "Job" },
                { q: "Â¿QuÃ© idiomas hablas?", a: "Hablo...", l: "Language" },
                { q: "Â¿DÃ³nde vives?", a: "Vivo en...", l: "Home" },
            ];

            const thirdPerson = [
                { q: "Â¿CÃ³mo se llama?", a: "Se llama...", l: "Name" },
                { q: "Â¿CÃ³mo se apellida?", a: "Se apellida...", l: "Last Name" },
                { q: "Â¿De dÃ³nde es?", a: "Es de...", l: "Origin" },
                { q: "Â¿CuÃ¡ntos aÃ±os tiene?", a: "Tiene ... aÃ±os.", l: "Age" },
                { q: "Â¿A quÃ© se dedica?", a: "Es... / Trabaja...", l: "Job" },
                { q: "Â¿QuÃ© idiomas habla?", a: "Habla...", l: "Language" },
                { q: "Â¿DÃ³nde vive?", a: "Vive en...", l: "Home" },
            ];

            const quizPool = useMemo(() => {
                const base = [
                    { type: 'mc', q: "Pregunta: Â¿CÃ³mo te llamas? Respuesta: ___", a: "Me llamo...", opts: ["Me llamo...", "Tengo...", "Soy de..."].sort(()=>0.5-Math.random()), exp: "Para responder al nombre usamos 'Me llamo'." },
                    { type: 'mc', q: "Pregunta: Â¿De dÃ³nde eres? Respuesta: ___", a: "Soy de...", opts: ["Soy...", "Me llamo...", "Soy de..."].sort(()=>0.5-Math.random()), exp: "Origen requiere 'Soy de'." },
                    { type: 'mc', q: "En tercera persona: Ã‰l ___ alto.", a: "Es", opts: ["Soy", "Eres", "Es"].sort(()=>0.5-Math.random()), exp: "'Es' es la conjugaciÃ³n para Ã‰l/Ella." },
                    { type: 'mc', q: "Pregunta: Â¿CuÃ¡ntos aÃ±os tienes? Respuesta: ___", a: "Tengo...", opts: ["Soy...", "Tengo...", "Estoy..."].sort(()=>0.5-Math.random()), exp: "En espaÃ±ol, la edad se 'tiene' (Tener), no se 'es'." },
                ];
                return base;
            }, []);

            if(mode === 'quiz') return <div className="p-6 max-w-md mx-auto pb-24"><LessonQuiz pool={quizPool} questionCount={10} onComplete={() => setMode('learn')} /></div>;

            return (
                <div className="p-6 max-w-md mx-auto pb-24 space-y-6">
                    <div className="flex gap-2 p-1 bg-gray-800 rounded-xl">
                        <button onClick={() => setTab('first')} className={`flex-1 py-2 rounded-lg font-bold text-sm transition-all ${tab === 'first' ? 'bg-pink-600 text-white' : 'text-gray-400 hover:text-white'}`}>TÃº (Informal)</button>
                        <button onClick={() => setTab('third')} className={`flex-1 py-2 rounded-lg font-bold text-sm transition-all ${tab === 'third' ? 'bg-pink-600 text-white' : 'text-gray-400 hover:text-white'}`}>Ã‰l/Ella/Usted</button>
                    </div>
                    
                    <div className="space-y-3">
                        {(tab === 'first' ? firstPerson : thirdPerson).map((item, i) => (
                            <div key={i} className="bg-gray-800 p-4 rounded-xl border border-gray-700">
                                <div className="flex justify-between items-center mb-2">
                                    <span className="text-xs font-bold bg-gray-700 text-gray-300 px-2 py-1 rounded uppercase tracking-wide">{item.l}</span>
                                </div>
                                <p className="text-pink-400 font-bold mb-1 text-lg">{item.q}</p>
                                <div className="bg-gray-900/50 p-2 rounded text-white border-l-2 border-pink-600">{item.a}</div>
                            </div>
                        ))}
                    </div>

                    <button onClick={() => setMode('quiz')} className="w-full bg-pink-600 hover:bg-pink-500 text-white font-bold py-4 rounded-2xl shadow-lg mt-4">Tomar Prueba</button>
                    <button onClick={onComplete} className="w-full border border-gray-600 text-gray-400 font-bold py-3 rounded-2xl mt-2">Volver</button>
                </div>
            );
        };

        const PronounsLesson = ({ onComplete }) => {
            const [mode, setMode] = useState('learn');
            const quizPool = useMemo(() => {
                const base = [
                    { type: 'mc', q: "Este es TU libro. (Informal)", a: "Tu libro", opts: ["Tu libro", "TÃº libro", "Te libro"].sort(()=>0.5-Math.random()), exp: "'Tu' sin tilde es posesivo (Your)." },
                    { type: 'mc', q: "Â¿CÃ³mo TE llamas? (Reflexivo)", a: "Te llamas", opts: ["Te llamas", "Tu llamas", "Se llama"].sort(()=>0.5-Math.random()), exp: "'Te' es el pronombre reflexivo para TÃº." },
                    { type: 'mc', q: "Ã‰l SE llama Juan.", a: "Se llama Juan", opts: ["Su llama Juan", "Se llama Juan", "Ã‰l llama Juan"].sort(()=>0.5-Math.random()), exp: "'Se' es reflexivo para Ã‰l/Ella." },
                    { type: 'mc', q: "Esta es SU casa. (De Ã©l)", a: "Su casa", opts: ["Su casa", "Se casa", "Ã‰l casa"].sort(()=>0.5-Math.random()), exp: "'Su' es el posesivo para Ã‰l/Ella." },
                    { type: 'mc', q: "NUESTRA casa.", a: "Nuestra casa", opts: ["Nuestra casa", "Nos casa", "Nosotros casa"].sort(()=>0.5-Math.random()), exp: "'Nuestra' es el posesivo femenino." },
                ];
                return base;
            }, []);

            if (mode === 'quiz') return <div className="p-6 max-w-md mx-auto pb-24"><LessonQuiz pool={quizPool} questionCount={10} onComplete={() => setMode('learn')} /></div>;

            return (
                <div className="p-6 max-w-md mx-auto pb-24 space-y-6">
                    <div className="bg-indigo-900/30 border border-indigo-500/30 p-4 rounded-2xl">
                        <h3 className="font-bold text-indigo-300 mb-2 text-lg">GuÃ­a RÃ¡pida</h3>
                        <p className="mb-4 text-sm text-gray-300">Diferencias clave entre pronombres similares.</p>
                        
                        <div className="space-y-4">
                            <div className="bg-gray-800 p-3 rounded-xl border border-gray-700">
                                <h4 className="font-bold text-white border-b border-gray-600 pb-1 mb-2">1. Personas (Sujeto)</h4>
                                <div className="flex flex-col gap-1 text-xs text-center">
                                    <div className="grid grid-cols-3 gap-1">
                                        <div className="bg-gray-700 p-1 rounded">Yo</div>
                                        <div className="bg-gray-700 p-1 rounded">TÃº</div>
                                        <div className="bg-gray-700 p-1 rounded">Ã‰l/Ella</div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-1">
                                        <div className="bg-gray-700 p-1 rounded text-green-300 font-bold">Nosotros</div>
                                        <div className="bg-gray-700 p-1 rounded">Ellos</div>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-gray-800 p-3 rounded-xl border border-gray-700">
                                <h4 className="font-bold text-pink-400 border-b border-gray-600 pb-1 mb-2">2. Reflexivos (AcciÃ³n a uno mismo)</h4>
                                <div className="flex flex-col gap-1 text-xs text-center">
                                    <div className="grid grid-cols-3 gap-1">
                                        <div className="bg-gray-900 p-1 rounded border border-pink-900">Me<br/><span className="text-[10px] text-gray-500">Myself</span></div>
                                        <div className="bg-gray-900 p-1 rounded border border-pink-900">Te<br/><span className="text-[10px] text-gray-500">Yourself</span></div>
                                        <div className="bg-gray-900 p-1 rounded border border-pink-900">Se<br/><span className="text-[10px] text-gray-500">Himself</span></div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-1">
                                        <div className="bg-gray-900 p-1 rounded border border-green-500/50 text-green-300 font-bold">Nos<br/><span className="text-[10px] text-gray-500">Ourselves</span></div>
                                        <div className="bg-gray-900 p-1 rounded border border-pink-900">Se<br/><span className="text-[10px] text-gray-500">Themselves</span></div>
                                    </div>
                                </div>
                                <div className="mt-2 text-xs italic text-center text-gray-400">Ej: "Nos llamamos" (We call ourselves)</div>
                            </div>

                            <div className="bg-gray-800 p-3 rounded-xl border border-gray-700">
                                <h4 className="font-bold text-yellow-400 border-b border-gray-600 pb-1 mb-2">3. Posesivos (Propiedad)</h4>
                                <div className="flex flex-col gap-1 text-xs text-center">
                                    <div className="grid grid-cols-3 gap-1">
                                        <div className="bg-gray-900 p-1 rounded border border-yellow-900">Mi<br/><span className="text-[10px] text-gray-500">My</span></div>
                                        <div className="bg-gray-900 p-1 rounded border border-yellow-900">Tu<br/><span className="text-[10px] text-gray-500">Your</span></div>
                                        <div className="bg-gray-900 p-1 rounded border border-yellow-900">Su<br/><span className="text-[10px] text-gray-500">His/Her</span></div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-1">
                                        <div className="bg-gray-900 p-1 rounded border border-green-500/50 text-green-300 font-bold">Nuestro<br/><span className="text-[10px] text-gray-500">Our</span></div>
                                        <div className="bg-gray-900 p-1 rounded border border-yellow-900">Su<br/><span className="text-[10px] text-gray-500">Their</span></div>
                                    </div>
                                </div>
                                <div className="mt-2 text-xs italic text-center text-gray-400">Ej: "Nuestro gato" (Our cat)</div>
                            </div>
                        </div>
                    </div>

                    <button onClick={() => setMode('quiz')} className="w-full bg-indigo-600 text-white font-bold py-4 rounded-2xl shadow-lg">Prueba</button>
                    <button onClick={onComplete} className="w-full border border-gray-600 text-gray-400 font-bold py-3 rounded-2xl">Volver</button>
                </div>
            );
        };

        const FeelingsLesson = ({ onComplete }) => {
            const [mode, setMode] = useState('learn');
            const FlipCard = ({ item }) => {
                const [flipped, setFlipped] = useState(false);
                return (
                    <div className={`relative h-24 cursor-pointer perspective-1000 group ${flipped ? 'flipped' : ''}`} onClick={() => setFlipped(!flipped)}>
                        <div className={`w-full h-full relative preserve-3d flip-card-inner`}>
                            <div className="absolute inset-0 bg-gray-800 rounded-xl border border-gray-700 flex flex-col items-center justify-center backface-hidden"><div className="text-3xl mb-1">{item.emoji}</div><span className="font-bold text-sm text-center px-1">{item.es}</span></div>
                            <div className="absolute inset-0 bg-yellow-900/40 rounded-xl border border-yellow-500 flex flex-col items-center justify-center backface-hidden rotate-y-180"><span className="font-bold text-sm text-yellow-200 text-center px-1">{item.en}</span></div>
                        </div>
                    </div>
                );
            };
            
            const quizPool = useMemo(() => {
                const base = [
                    { type: 'mc', q: "Por la maÃ±ana decimos...", a: "Buenos dÃ­as", opts: ["Buenas noches", "Hola", "Buenos dÃ­as"].sort(()=>0.5-Math.random()), exp: "'Buenos dÃ­as' se usa en la maÃ±ana." }
                ];
                // Add feelings questions with sentences context
                FEELINGS_DATA.slice(0, 5).forEach(f => {
                    // Create simple sentences
                    const sentence = f.en.startsWith("I am") 
                        ? `En espaÃ±ol: "${f.en}" se dice...`
                        : `Â¿QuÃ© significa "${f.es}"?`;
                    
                    base.push({ 
                        type: 'mc', 
                        q: sentence, 
                        a: f.es, 
                        opts: [f.es, ...getSmartDistractors(f.es, FEELINGS_DATA)].sort(()=>0.5-Math.random()), 
                        exp: `${f.es} significa ${f.en}` 
                    });
                });
                return base;
            }, []);

            if (mode === 'quiz') return <div className="p-6 max-w-md mx-auto pb-24"><LessonQuiz pool={quizPool} questionCount={10} onComplete={() => setMode('learn')} /></div>;
            return (
                <div className="p-6 max-w-md mx-auto pb-24 space-y-6">
                    <div><h3 className="font-bold text-yellow-400 mb-3 uppercase tracking-wider">Saludos</h3><div className="grid grid-cols-2 gap-3">{GREETINGS_DATA.map((g, i) => <FlipCard key={i} item={g} />)}</div></div>
                    <div><h3 className="font-bold text-yellow-400 mb-3 uppercase tracking-wider">Sentimientos</h3><div className="grid grid-cols-2 gap-3">{FEELINGS_DATA.map((f, i) => <FlipCard key={i} item={f} />)}</div></div>
                    <button onClick={() => setMode('quiz')} className="w-full bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-4 rounded-2xl shadow-lg mt-4">Prueba</button>
                    <button onClick={onComplete} className="w-full border border-gray-600 text-gray-400 font-bold py-3 rounded-2xl mt-2">Volver</button>
                </div>
            );
        };

        const CharacterLesson = ({ onComplete }) => {
            const [shuffledChars, setShuffledChars] = useState([]);
            const [index, setIndex] = useState(0);
            const [revealed, setRevealed] = useState({});

            useEffect(() => {
                setShuffledChars([...CHARACTERS].sort(() => 0.5 - Math.random()));
            }, []);

            if(shuffledChars.length === 0) return <div>Cargando...</div>;

            const person = shuffledChars[index];
            const toggleReveal = (key) => setRevealed(prev => ({ ...prev, [key]: !prev[key] }));
            const nextPerson = () => { setRevealed({}); if (index < shuffledChars.length - 1) setIndex(index + 1); else onComplete(); };
            
            // Updated questions list
            const questions = [
                { id: 'name', q: 'Â¿CÃ³mo se llama?', a: `Se llama ${person.firstName}.`, icon: <Icons.User size={18}/> },
                { id: 'lastname', q: 'Â¿CÃ³mo se apellida?', a: `Se apellida ${person.lastName}.`, icon: <Icons.User size={18}/> },
                { id: 'age', q: 'Â¿CuÃ¡ntos aÃ±os tiene?', a: `Tiene ${person.age} aÃ±os.`, icon: <Icons.Calendar size={18}/> },
                { id: 'origin', q: 'Â¿De dÃ³nde es?', a: `Es de ${person.origin}.`, icon: <Icons.MapPin size={18}/> },
                { id: 'nat', q: 'Â¿CuÃ¡l es su nacionalidad?', a: `Es ${person.nationality}.`, icon: <Icons.Flag size={18}/> },
                { id: 'lang', q: 'Â¿QuÃ© idioma habla?', a: `Habla ${person.language}.`, icon: <Icons.MessageCircle size={18}/> },
            ];

            return (
                <div className="flex flex-col h-full max-w-md mx-auto p-4 pt-0">
                    <div className="relative w-full aspect-video bg-gradient-to-br from-indigo-900 to-gray-900 rounded-2xl shadow-2xl border border-gray-700 mb-6 flex-shrink-0 flex items-center justify-center overflow-hidden">
                        <div className="text-center animate-fade-in" key={person.id}>
                            <div className="text-6xl mb-2">{person.flag}</div>
                            <h2 className="text-3xl font-black text-white tracking-tight">{person.firstName} {person.lastName}</h2>
                            <p className="text-indigo-300 font-medium mt-1 uppercase tracking-widest text-sm">{person.job}</p>
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto space-y-3 pb-24 scrollbar-hide">
                        {questions.map((item) => (
                            <div key={item.id} className="bg-gray-800 rounded-xl overflow-hidden border border-gray-700">
                                <button onClick={() => toggleReveal(item.id)} className="w-full flex items-center justify-between p-4 text-left active:bg-gray-700 transition-colors">
                                    <div className="flex items-center gap-3"><div className="text-pink-400">{item.icon}</div><span className="font-medium text-gray-200">{item.q}</span></div>
                                    <Icons.ChevronDown size={16} className={`text-gray-500 transition-transform ${revealed[item.id] ? 'rotate-180' : ''}`} />
                                </button>
                                {revealed[item.id] && <div className="bg-gray-900/50 p-4 pt-0 border-t border-gray-700/50 text-indigo-300 font-semibold animate-in slide-in-from-top-2 duration-200"><div className="pt-3">{item.a}</div></div>}
                            </div>
                        ))}
                    </div>
                    <div className="fixed bottom-6 left-0 right-0 px-6 max-w-md mx-auto">
                        <button onClick={nextPerson} className="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-2xl shadow-lg shadow-indigo-900/50 flex items-center justify-center gap-2 active:scale-95 transition-all">{index === shuffledChars.length - 1 ? "Terminar LecciÃ³n" : "Siguiente Personaje"} <Icons.ChevronRight size={20} /></button>
                    </div>
                </div>
            );
        };

        const JobsLesson = ({ onComplete }) => {
            const [mode, setMode] = useState('learn');
            const FlipCard = ({ job }) => {
                const [flipped, setFlipped] = useState(false);
                return (
                    <div className={`relative h-20 cursor-pointer perspective-1000 group ${flipped ? 'flipped' : ''}`} onClick={() => setFlipped(!flipped)}>
                        <div className={`w-full h-full relative preserve-3d flip-card-inner`}>
                            <div className="absolute inset-0 bg-gray-800 p-4 rounded-xl border border-gray-700 flex items-center justify-between backface-hidden">
                                <div className="flex items-center gap-3"><div className="text-3xl">{job.emoji}</div><div className="font-bold text-white text-base capitalize">{job.masc} <span className="text-gray-500 text-sm font-normal">/ {job.fem}</span></div></div><Icons.ChevronRight size={16} className="text-gray-600" />
                            </div>
                            <div className="absolute inset-0 bg-teal-900/40 p-4 rounded-xl border border-teal-500 flex items-center justify-center backface-hidden rotate-y-180"><span className="font-bold text-teal-200 text-lg">{job.eng}</span></div>
                        </div>
                    </div>
                );
            };
            const PlaceCard = ({ place }) => {
                const [flipped, setFlipped] = useState(false);
                return (
                    <div className={`relative h-16 cursor-pointer perspective-1000 group ${flipped ? 'flipped' : ''}`} onClick={() => setFlipped(!flipped)}>
                        <div className={`w-full h-full relative preserve-3d flip-card-inner`}>
                            <div className="absolute inset-0 bg-gray-800 p-3 rounded-lg border border-gray-700 text-sm font-medium text-center flex items-center justify-center backface-hidden">{place.es}</div>
                            <div className="absolute inset-0 bg-teal-900/40 p-3 rounded-lg border border-teal-500 text-sm font-medium text-center flex items-center justify-center backface-hidden rotate-y-180 text-teal-200">{place.en}</div>
                        </div>
                    </div>
                );
            };

            const quizPool = useMemo(() => {
                const base = [
                    { type: 'mc', q: "Alguien que apaga fuegos es un...", a: "Bombero", opts: ["Bombero", "Dentista", "Doctor"].sort(()=>0.5-Math.random()), exp: "Apagar fuegos = Bombero." }
                ];
                // Add more job sentences
                JOBS_DATA.slice(0, 5).forEach(j => {
                    base.push({ 
                        type: 'mc', 
                        q: `Trabaja como ${j.eng}. Es...`, 
                        a: j.masc, 
                        opts: [j.masc, ...getSmartDistractors(j.masc, JOBS_DATA)].sort(()=>0.5-Math.random()), 
                        exp: `${j.masc} es la palabra para ${j.eng}` 
                    });
                });
                return base;
            }, []);

            if (mode === 'quiz') return <div className="p-6 max-w-md mx-auto pb-24"><LessonQuiz pool={quizPool} questionCount={10} onComplete={() => setMode('learn')} /></div>;
            return (
                <div className="flex flex-col h-full max-w-md mx-auto p-4 pt-0 pb-20 overflow-y-auto scrollbar-hide">
                    <div className="space-y-6">
                        <div className="bg-teal-900/20 border border-teal-500/30 p-4 rounded-2xl"><h3 className="font-bold text-teal-400 text-lg mb-2">Estructura</h3><p className="text-sm text-gray-300">Yo soy <b>un/una</b> [ProfesiÃ³n].</p><p className="text-sm text-gray-300">Yo trabajo en <b>[Lugar]</b>.</p></div>
                        <div className="space-y-3"><h3 className="font-bold text-white ml-1">Profesiones</h3>{JOBS_DATA.map((job, i) => <FlipCard key={i} job={job} />)}</div>
                        <div className="space-y-3"><h3 className="font-bold text-white ml-1">Lugares de Trabajo</h3><div className="grid grid-cols-2 gap-3">{PLACES_DATA.map((place, i) => <PlaceCard key={i} place={place} />)}</div></div>
                        <button onClick={() => setMode('quiz')} className="w-full bg-teal-600 hover:bg-teal-500 text-white font-bold py-4 rounded-2xl shadow-lg">Prueba</button>
                        <button onClick={onComplete} className="w-full border border-gray-600 text-gray-400 font-bold py-3 rounded-2xl mt-2">Volver</button>
                    </div>
                </div>
            );
        };

        const NationalitiesLesson = ({ onComplete }) => {
            const [mode, setMode] = useState('list');
            const quizPool = useMemo(() => {
                const base = [
                    { type: 'mc', q: "Plural de 'Chino'", a: "Chinos", opts: ["Chinos", "Chinas", "Chinoes"].sort(()=>0.5-Math.random()), exp: "Termina en vocal, agrega 's'." },
                    { type: 'mc', q: "Ellas son de Francia. Son...", a: "Francesas", opts: ["Francesas", "Franceses", "FrancÃ©s"].sort(()=>0.5-Math.random()), exp: "Femenino Plural." }
                ];
                return base;
            }, []);

            if(mode === 'quiz') return <div className="p-6 max-w-md mx-auto pb-24"><LessonQuiz pool={quizPool} questionCount={10} onComplete={() => setMode('list')} /></div>;
            return (
                <div className="flex flex-col h-full max-w-md mx-auto p-4 pt-8 pb-20 overflow-y-auto scrollbar-hide">
                    <div className="flex gap-2 mb-6 p-1 bg-gray-800 rounded-xl"><button onClick={() => setMode('list')} className={`flex-1 py-2 rounded-lg font-bold text-sm ${mode === 'list' ? 'bg-rose-600' : ''}`}>Lista</button><button onClick={() => setMode('plural')} className={`flex-1 py-2 rounded-lg font-bold text-sm ${mode === 'plural' ? 'bg-rose-600' : ''}`}>Plural</button><button onClick={() => setMode('quiz')} className={`flex-1 py-2 rounded-lg font-bold text-sm ${mode === 'quiz' ? 'bg-rose-600' : ''}`}>Prueba</button></div>
                    {mode === 'list' ? <div className="space-y-3">{COUNTRIES_DATA.map((item, i) => <div key={i} className="bg-gray-800 p-4 rounded-xl border border-gray-700"><div className="font-black text-lg text-white mb-2">{item.country}</div><div className="grid grid-cols-2 gap-4 text-sm"><div><span className="block text-gray-500 text-xs">Masculino</span><span className="text-rose-300">{item.natM}</span></div><div><span className="block text-gray-500 text-xs">Femenino</span><span className="text-rose-300">{item.natF}</span></div></div></div>)}</div> : <div className="space-y-4"><div className="bg-rose-900/20 border border-rose-500/30 p-4 rounded-2xl mb-4"><h3 className="font-bold text-rose-400 mb-2">Reglas de Plural</h3><ul className="list-disc list-inside text-sm text-gray-300"><li>Vocal: +<b>s</b></li><li>Consonante: +<b>es</b></li></ul></div>{COUNTRIES_DATA.map((item, i) => <div key={i} className="bg-gray-800 p-4 rounded-xl border border-gray-700 space-y-2"><div className="font-bold text-white border-b border-gray-700 pb-2 mb-2">{item.country}</div><div className="flex justify-between"><span className="text-gray-400">Ellos son...</span><span className="text-rose-400 font-bold">{item.natM}s</span></div><div className="flex justify-between"><span className="text-gray-400">Ellas son...</span><span className="text-rose-400 font-bold">{item.natF}s</span></div></div>)}</div>}
                    <button onClick={onComplete} className="mt-8 w-full bg-rose-600 hover:bg-rose-500 text-white font-bold py-4 rounded-2xl shadow-lg">Completar</button>
                </div>
            );
        };

        const ConjugationSection = ({ onComplete }) => {
            const [mode, setMode] = useState('list');
            const [selectedVerb, setSelectedVerb] = useState(null);
            
            const quizPool = useMemo(() => {
                const base = [
                    { type: 'mc', q: "Yo ___ (Ser)", a: "Soy", opts: ["Soy", "Eres", "Es"].sort(()=>0.5-Math.random()), exp: "Yo soy." },
                    { type: 'mc', q: "TÃº ___ (Tener)", a: "Tienes", opts: ["Tengo", "Tienes", "Tiene"].sort(()=>0.5-Math.random()), exp: "TÃº tienes." },
                    { type: 'mc', q: "Ella ___ (Estar)", a: "EstÃ¡", opts: ["Estoy", "EstÃ¡", "EstÃ¡s"].sort(()=>0.5-Math.random()), exp: "Ella estÃ¡." }
                ];
                return base;
            }, []);

            if (mode === 'quiz') return <div className="p-6 max-w-md mx-auto pb-24"><LessonQuiz pool={quizPool} questionCount={10} onComplete={() => setMode('list')} /></div>;
            if (selectedVerb) return (
                <div className="p-6 max-w-md mx-auto pb-24 space-y-4">
                    <button onClick={() => setSelectedVerb(null)} className="flex items-center gap-2 text-cyan-400 mb-2"><Icons.ArrowLeft size={20}/> Volver</button>
                    <h2 className="text-2xl font-bold text-white">{selectedVerb.v} <span className="text-gray-500 text-lg">({selectedVerb.t})</span></h2>
                    <div className="bg-gray-800 rounded-xl overflow-hidden border border-gray-700"><div className="divide-y divide-gray-700">{["Yo", "TÃº", "Ã‰l/Ella", "Nosotros", "Ellos"].map((p, i) => <div key={i} className="grid grid-cols-2 p-3 text-sm"><span className="text-cyan-200">{p}</span><span className="font-bold">{selectedVerb.c[i]}</span></div>)}</div></div>
                </div>
            );
            return (
                <div className="p-6 max-w-md mx-auto pb-24 space-y-4">
                    <h2 className="text-2xl font-bold mb-4">Verbos</h2>
                    <div className="grid grid-cols-1 gap-3">{CONJUGATION_DATA.map((v, i) => <button key={i} onClick={() => setSelectedVerb(v)} className="bg-gray-800 p-4 rounded-xl border border-gray-700 flex justify-between items-center text-left hover:bg-gray-700"><div><span className="block font-bold text-lg text-white">{v.v}</span><span className="text-xs text-gray-400">{v.t}</span></div><Icons.ChevronRight size={20} className="text-gray-600"/></button>)}</div>
                    <button onClick={() => setMode('quiz')} className="w-full bg-cyan-600 text-white font-bold py-4 rounded-2xl shadow-lg mt-4">Prueba</button>
                    <button onClick={onComplete} className="w-full border border-gray-600 text-gray-400 font-bold py-3 rounded-2xl">Volver</button>
                </div>
            );
        };

        const VerbLesson = ({ onComplete }) => {
            const [mode, setMode] = useState('learn');
            const quizPool = useMemo(() => {
                return [
                    { type: 'mc', q: "Para hablar de la hora, usamos...", a: "Ser", opts: ["Ser", "Estar", "Tener"].sort(()=>0.5-Math.random()), exp: "La hora es permanente/esencia (Son las 2)." },
                    { type: 'mc', q: "Para hablar de ubicaciÃ³n, usamos...", a: "Estar", opts: ["Ser", "Estar", "Tener"].sort(()=>0.5-Math.random()), exp: "UbicaciÃ³n = Estar (No matter how permanent)." },
                    { type: 'mc', q: "Para decir la edad, usamos...", a: "Tener", opts: ["Ser", "Estar", "Tener"].sort(()=>0.5-Math.random()), exp: "En espaÃ±ol, 'tienes' aÃ±os." },
                    { type: 'mc', q: "Yo ___ feliz hoy (emociÃ³n).", a: "Estoy", opts: ["Soy", "Estoy", "Tengo"].sort(()=>0.5-Math.random()), exp: "EmociÃ³n temporal = Estar." },
                    { type: 'mc', q: "Nosotros ___ altos (descripciÃ³n).", a: "Somos", opts: ["Somos", "Estamos", "Tenemos"].sort(()=>0.5-Math.random()), exp: "DescripciÃ³n fÃ­sica = Ser." },
                ];
            }, []);

            if (mode === 'quiz') return <div className="p-6 max-w-md mx-auto pb-24"><LessonQuiz pool={quizPool} questionCount={5} onComplete={() => setMode('learn')} /></div>;

            return (
            <div className="p-6 max-w-md mx-auto pb-24 space-y-6">
                <div className="bg-gray-800 p-4 rounded-xl border-l-4 border-blue-500">
                    <div className="flex justify-between items-start mb-2">
                        <h3 className="font-bold text-blue-400 text-xl">SER</h3>
                        <span className="text-xs bg-blue-900 text-blue-200 px-2 py-1 rounded">Permanente</span>
                    </div>
                    <p className="text-sm text-gray-300 mb-2 italic">"To be" (Esencia)</p>
                    <div className="grid grid-cols-2 gap-2 text-sm">
                        <div className="bg-gray-900 p-2 rounded border border-gray-700"><span className="text-blue-300 font-bold">D</span>escription</div>
                        <div className="bg-gray-900 p-2 rounded border border-gray-700"><span className="text-blue-300 font-bold">O</span>ccupation</div>
                        <div className="bg-gray-900 p-2 rounded border border-gray-700"><span className="text-blue-300 font-bold">C</span>haracteristic</div>
                        <div className="bg-gray-900 p-2 rounded border border-gray-700"><span className="text-blue-300 font-bold">T</span>ime/Date</div>
                        <div className="bg-gray-900 p-2 rounded border border-gray-700"><span className="text-blue-300 font-bold">O</span>rigin</div>
                        <div className="bg-gray-900 p-2 rounded border border-gray-700"><span className="text-blue-300 font-bold">R</span>elationship</div>
                    </div>
                    <p className="mt-3 text-xs text-center text-gray-400">Ej: "Soy alto", "Son las dos".</p>
                </div>

                <div className="bg-gray-800 p-4 rounded-xl border-l-4 border-orange-500">
                     <div className="flex justify-between items-start mb-2">
                        <h3 className="font-bold text-orange-400 text-xl">ESTAR</h3>
                        <span className="text-xs bg-orange-900 text-orange-200 px-2 py-1 rounded">Temporal</span>
                    </div>
                    <p className="text-sm text-gray-300 mb-2 italic">"To be" (Estado)</p>
                     <div className="grid grid-cols-2 gap-2 text-sm">
                        <div className="bg-gray-900 p-2 rounded border border-gray-700"><span className="text-orange-300 font-bold">P</span>osition</div>
                        <div className="bg-gray-900 p-2 rounded border border-gray-700"><span className="text-orange-300 font-bold">L</span>ocation</div>
                        <div className="bg-gray-900 p-2 rounded border border-gray-700"><span className="text-orange-300 font-bold">A</span>ction (-ing)</div>
                        <div className="bg-gray-900 p-2 rounded border border-gray-700"><span className="text-orange-300 font-bold">C</span>ondition</div>
                        <div className="bg-gray-900 p-2 rounded border border-gray-700"><span className="text-orange-300 font-bold">E</span>motion</div>
                    </div>
                    <p className="mt-3 text-xs text-center text-gray-400">Ej: "Estoy triste", "EstÃ¡ en Madrid".</p>
                </div>

                <div className="bg-gray-800 p-4 rounded-xl border-l-4 border-green-500">
                     <div className="flex justify-between items-start mb-2">
                        <h3 className="font-bold text-green-400 text-xl">TENER</h3>
                        <span className="text-xs bg-green-900 text-green-200 px-2 py-1 rounded">PosesiÃ³n</span>
                    </div>
                    <p className="text-sm text-gray-300 mb-2 italic">"To have" (Usado en modismos)</p>
                    <ul className="text-sm space-y-1 list-disc list-inside text-gray-300">
                        <li>Edad ("Tengo 20 aÃ±os")</li>
                        <li>Hambre / Sed ("Tengo hambre")</li>
                        <li>Calor / FrÃ­o ("Tengo calor")</li>
                        <li>Miedo / SueÃ±o</li>
                    </ul>
                </div>
                
                <button onClick={() => setMode('quiz')} className="w-full bg-emerald-600 text-white font-bold py-4 rounded-2xl shadow-lg mt-4">Prueba de Verbos</button>
                <button onClick={onComplete} className="w-full border border-gray-600 text-gray-400 font-bold py-3 rounded-2xl mt-2">Volver</button>
            </div>
            );
        };

        // --- VOCAB MIX (FIXED) ---
        const VocabMix = ({ onComplete }) => {
            const [vocab, setVocab] = useState([]);
            
            useEffect(() => {
                // Generate and randomize on mount only
                const list = generateVocabBank().sort(() => 0.5 - Math.random());
                setVocab(list.map((v, i) => ({ ...v, id: i })));
            }, []);

            // Individual Card Component
            const VocabCard = ({ v }) => {
                const [flipped, setFlipped] = useState(false);
                return (
                    <div 
                        onClick={() => setFlipped(!flipped)} 
                        className={`relative h-24 cursor-pointer perspective-1000 group ${flipped ? 'flipped' : ''}`}
                    >
                         <div className={`w-full h-full relative preserve-3d flip-card-inner transition-transform duration-300`}>
                            {/* Front (Spanish) */}
                            <div className="absolute inset-0 bg-gray-800 p-2 rounded-xl border border-gray-700 flex items-center justify-center backface-hidden shadow-lg">
                                <span className="text-white font-bold text-center text-lg">{v.es}</span>
                            </div>
                            {/* Back (English) */}
                            <div className="absolute inset-0 bg-pink-900/90 p-2 rounded-xl border border-pink-500 flex items-center justify-center backface-hidden rotate-y-180 shadow-lg">
                                <span className="text-pink-100 font-bold text-center text-lg">{v.en}</span>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="p-4 max-w-md mx-auto h-[calc(100vh-80px)] flex flex-col">
                    <div className="mb-4">
                        <h2 className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-pink-400 to-purple-400">Vocabulario Mix</h2>
                        <p className="text-gray-400 text-xs">Toca para voltear. DesplÃ¡zate para ver mÃ¡s.</p>
                    </div>
                    
                    {/* 2 Column Grid */}
                    <div className="flex-1 overflow-y-auto scrollbar-hide pb-20">
                        <div className="grid grid-cols-2 gap-3">
                            {vocab.map(v => <VocabCard key={v.id} v={v} />)}
                        </div>
                    </div>

                    <div className="fixed bottom-0 left-0 right-0 p-6 bg-gray-900/95 backdrop-blur border-t border-gray-800 max-w-md mx-auto">
                        <button onClick={onComplete} className="w-full border border-gray-600 text-gray-400 font-bold py-3 rounded-2xl">Volver al MenÃº</button>
                    </div>
                </div>
            );
        };

        const FinalQuiz = ({ onComplete }) => {
            const [pool, setPool] = useState([]);
            
            useEffect(() => {
                const generateFinalPool = () => {
                    let p = [
                         { type: 'mc', q: "___ soy doctor.", a: "Yo", opts: ["Yo", "TÃº", "Ã‰l"].sort(()=>0.5-Math.random()), exp: "Yo soy." },
                         { type: 'mc', q: "Ella ___ hambre.", a: "tiene", opts: ["es", "estÃ¡", "tiene"].sort(()=>0.5-Math.random()), exp: "Tener hambre." },
                         { type: 'mc', q: "Â¿DÃ³nde ___ tÃº?", a: "vives", opts: ["vivo", "vives", "vive"].sort(()=>0.5-Math.random()), exp: "TÃº vives." },
                         { type: 'mc', q: "Nosotros ___ en el parque.", a: "estamos", opts: ["somos", "estamos", "tenemos"].sort(()=>0.5-Math.random()), exp: "UbicaciÃ³n = Estar." },
                         { type: 'mc', q: "Â¿CÃ³mo te ___?", a: "llamas", opts: ["llama", "llamas", "llamo"].sort(()=>0.5-Math.random()), exp: "Te llamas." },
                         { type: 'mc', q: "El plural de 'Mexicano'", a: "Mexicanos", opts: ["Mexicanos", "Mexicano", "Mexicanoes"].sort(()=>0.5-Math.random()), exp: "Termina en vocal + s." },
                         { type: 'mc', q: "Â¿QuÃ© tiempo hace? (Windy)", a: "Hace viento", opts: ["EstÃ¡ viento", "Hace viento", "Es viento"].sort(()=>0.5-Math.random()), exp: "Clima = Hace." },
                    ];
                    
                    // Add real vocab questions for filler
                    const vocab = generateVocabBank().sort(() => 0.5 - Math.random());
                    
                    // We need 18 more to reach 25
                    let vIndex = 0;
                    while (p.length < 25 && vIndex < vocab.length) {
                        const item = vocab[vIndex];
                        // Use getDistractors (generic) for mixed vocab pool
                        const distractors = getDistractors(item.en, 2); 
                        p.push({
                            type: 'mc',
                            q: `Â¿QuÃ© significa "${item.es}"?`,
                            a: item.en,
                            opts: [item.en, ...distractors].sort(() => 0.5 - Math.random()),
                            exp: `${item.es} = ${item.en}`
                        });
                        vIndex++;
                    }
                    return p;
                };

                setPool(generateFinalPool());
            }, []);

            if (pool.length === 0) return <div>Generando examen...</div>;

            return (
                <div className="p-6 max-w-md mx-auto pb-24">
                    <h2 className="text-xl font-bold mb-4 text-yellow-500">Examen Final (25 Preguntas)</h2>
                    <LessonQuiz 
                        pool={pool} 
                        questionCount={25} 
                        onComplete={() => {
                            onComplete();
                        }} 
                    />
                </div>
            );
        };

        // --- ROUTER ---
        const App = () => {
            const [view, setView] = useState('dashboard');

            // Scroll to top whenever view changes
            useEffect(() => {
                window.scrollTo(0, 0);
            }, [view]);
            
            // Simple view router
            const renderView = () => {
                switch(view) {
                    case 'alphabet': return <AlphabetLesson onComplete={()=>setView('dashboard')} />;
                    case 'numbers': return <NumbersLesson onComplete={()=>setView('dashboard')} />;
                    case 'calendar': return <CalendarLesson onComplete={()=>setView('dashboard')} />;
                    case 'characters': return <CharacterLesson onComplete={()=>setView('dashboard')} />;
                    case 'verbs': return <VerbLesson onComplete={()=>setView('dashboard')} />;
                    case 'weather': return <WeatherLesson onComplete={()=>setView('dashboard')} />;
                    case 'vocabmix': return <VocabMix onComplete={()=>setView('dashboard')} />;
                    case 'jobs': return <JobsLesson onComplete={()=>setView('dashboard')} />;
                    case 'nationalities': return <NationalitiesLesson onComplete={()=>setView('dashboard')} />;
                    case 'finalquiz': return <FinalQuiz onComplete={()=>setView('dashboard')} />;
                    case 'intro': return <IntroLesson onComplete={()=>setView('dashboard')} />;
                    case 'interview': return <InterviewLesson onComplete={()=>setView('dashboard')} />;
                    case 'colors': return <ColorsLesson onComplete={()=>setView('dashboard')} />;
                    case 'feelings': return <FeelingsLesson onComplete={()=>setView('dashboard')} />;
                    case 'pronouns': return <PronounsLesson onComplete={()=>setView('dashboard')} />;
                    case 'conjugations': return <ConjugationSection onComplete={()=>setView('dashboard')} />;
                    default: return <Dashboard onSelectLesson={setView} />;
                }
            };
            
            return (
                <div className="min-h-screen bg-gray-900 text-white font-sans antialiased">
                    <div className="sticky top-0 z-10 bg-gray-900/90 backdrop-blur-md border-b border-gray-800 p-4 flex items-center justify-between">
                        {view!=='dashboard' ? 
                            <button onClick={()=>setView('dashboard')} className="flex items-center gap-2 text-indigo-400 font-bold"><Icons.ArrowLeft size={20}/> MenÃº</button> 
                            : <div className="text-xl font-black text-indigo-500 tracking-tighter">NOTAS<span className="text-pink-500">.APP</span></div>
                        }
                    </div>
                    {renderView()}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>